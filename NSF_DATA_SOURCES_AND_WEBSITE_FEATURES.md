# Data Sources and Website Features — For NSF Grant Applications

This document clarifies the **data sources** used by the RIQ LabMatch platform, the **distinction between NSF-provided data and other datasets**, which **website features** rely on which data, and **important caveats** for NSF reviewers.

---

## 1. NSF Data: AwardSearch API vs. AwardSearch Download (Bulk Export)

| Aspect | **NSF AwardSearch API** | **NSF AwardSearch Download (Bulk Export)** |
|--------|-------------------------|-------------------------------------------|
| **What it is** | Live, query-based API requiring authentication (API key). Returns awards/PI data per request. | Public bulk export: award data downloaded as JSON files (e.g., by year or search result). No API key. |
| **Cost / access** | May involve rate limits and/or terms that require API registration. | **Free, public.** Data is downloaded once and processed locally. |
| **Used by this project?** | **No.** This application does **not** use the NSF AwardSearch API. | **Yes.** This application uses **only** NSF data obtained via **AwardSearch Download** (bulk JSON files). |

**Summary for reviewers:** All NSF-derived faculty data in this project comes from **NSF Award Search bulk downloads (file-based export)**. We do **not** call the NSF AwardSearch API; there is no API key or live API dependency for NSF data.

---

## 2. Other Data: Harvard / MVP Pipeline Data

In addition to NSF (bulk download) data, the platform can use a separate, **non-NSF** dataset produced by an internal “MVP” (Harvard-focused) pipeline:

| Dataset | Source | Content | Role in application |
|---------|--------|---------|----------------------|
| **Harvard / MVP faculty** | Internal pipeline (e.g., `harvard_mvp_1500.json`, `faculty_working.json`) | Harvard (and possibly other) institutions; often includes enriched fields (e.g., contact info, websites, h-index) from public or internal sources. | **Fallback** when NSF bulk data is not present. Used for development and for institution-specific demos. |

**Important:**  
- **NSF data** = from NSF Award Search **bulk download only** (see Section 1).  
- **Harvard/MVP data** = from a **separate, non-NSF pipeline**. It is used only when the NSF-derived faculty file is not available. It is **not** NSF data and should not be described as such in the grant application.

---

## 3. How the Application Chooses Data (Single Faculty List)

The website uses **one faculty list at a time**. The source is chosen at startup in this order:

1. **NSF-derived file (preferred):** `faculty_pipeline/output/nsf_all_faculty.json`  
   - Generated by our script from **NSF Award Search bulk-download JSON files** (see Section 4).  
   - When this file exists, **all** faculty-dependent features use NSF-derived data (with the caveats in Section 5).

2. **MVP fallback:** `faculty_pipeline/output/harvard_mvp_1500.json`  
   - Used only if the NSF file above is not present. This is **Harvard/MVP pipeline data**, not NSF.

3. **Bundled fallback:** `faculty_pipeline/data/faculty_working.json`  
   - Used only if neither of the above exists (e.g., default/sample data).

**For the grant:** When we report “using NSF data,” we mean that `nsf_all_faculty.json` is present and is the active source. When that file is absent, the site uses non-NSF (MVP/bundled) data only.

---

## 4. Where NSF Data Lives and How It Is Produced

- **NSF data is not stored in the application database.** The database holds only user accounts, profiles, saved PIs, resumes, and password-reset tokens (see Section 6).
- **NSF-derived faculty data** is stored in a **single JSON file** produced by our pipeline:
  - **File:** `faculty_pipeline/output/nsf_all_faculty.json`
  - **Input:** NSF Award Search **bulk-download** JSON files (e.g., under `nsf_data/` or a folder such as `Documents/RIQ/` with subfolders 2023, 2024, 2025).
  - **Script:** `faculty_pipeline/scripts/load_all_nsf_data.py`  
    - Reads local JSON files (no API calls).  
    - Extracts PI name, email (if present in export), institution, research-related fields, and funding info.  
    - Deduplicates by PI and writes `output/nsf_all_faculty.json`.

So: **“Where in the system is the NSF data?”** → In the **file** `faculty_pipeline/output/nsf_all_faculty.json`. The **database does not contain** the list of institutions or NSF PIs; it only stores user-related data.

---

## 5. Which Website Features Use Which Data

When the active source is **NSF** (`nsf_all_faculty.json`), the following use that NSF-derived data. When the active source is **MVP/bundled**, the same features use that data instead.

| Feature | Data used | Notes |
|---------|-----------|--------|
| **Find Labs / Browse (filter by institution, field, etc.)** | Active faculty list (NSF or MVP) | Institution and field lists are built from the active JSON file. With NSF data, institutions are **all those present in the NSF bulk export**. |
| **Institution filter** | Active faculty list | All institutions shown are from the active source (NSF or MVP). |
| **Field / department filter** | Active faculty list | From NSF data: derived from award metadata (e.g., directorate, program). From MVP: from pipeline fields. |
| **Matching (e.g., 5-question profile)** | Active faculty list | Match scores and rankings use the same list (NSF or MVP). |
| **Saved PIs** | User choices; PI identifiers come from active list | Stored in DB; the PI records themselves come from the active faculty file. |
| **Email drafting (e.g., to a PI)** | Active faculty list | PI name, institution, and any available contact/research info from the active list. |
| **Onboarding “Your institution” dropdown** | Active faculty list | Same institution list as Find Labs (NSF or MVP). |

**Caveat:** NSF bulk export often **does not include** email, website, or h-index for many PIs. The application still works: it shows whatever fields are present and prioritizes rows with email/website when available. So “NSF data” here means “NSF award + PI + institution (and optional contact) as provided in the bulk export,” not enriched data from other APIs.

---

## 6. What Is in the Database (No NSF PI/Institution Tables)

The application database (e.g., SQLite) contains **only**:

- **user** — accounts (username, email, password hash).  
- **user_profile** — research interests, academic level, optional **institution** (user’s own choice from dropdown).  
- **saved_pi** — which PIs each user saved (by PI id/name and optional email).  
- **resume** — uploaded resume files and extracted text.  
- **password_reset_token** — tokens for forgot-password flow.

**The database does not store:**  
- The list of NSF (or any) institutions.  
- The list of PIs or NSF award data.  

Those come only from the **active faculty JSON file** (e.g., `nsf_all_faculty.json`).

---

## 7. Important Caveats for NSF Reviewers

1. **NSF data source:** We use **only** data obtained via **NSF Award Search bulk download (file export)**. We do **not** use the NSF AwardSearch API; no API key is used for NSF data.

2. **Completeness of contact info:** NSF bulk export often does not include email or website for many PIs. The platform still uses NSF data; it displays available fields and may show “[placeholder]” or similar where contact info is missing. This is a limitation of the **export format**, not of the platform’s use of NSF data.

3. **Institutions:** When running on NSF data, the set of institutions is exactly the set present in the **NSF bulk export** we processed (e.g., 2023–2025 awards). We do not add institutions from non-NSF sources to the “NSF” view.

4. **Harvard/MVP data:** A separate, non-NSF pipeline produces Harvard-focused (and possibly other) faculty files. These are used **only as a fallback** when the NSF-derived file is not present. They must not be described as NSF data in the grant.

5. **Reproducibility:** NSF-derived results can be reproduced by (1) obtaining the same NSF Award Search bulk export, (2) running `scripts/load_all_nsf_data.py`, and (3) ensuring `output/nsf_all_faculty.json` is the only faculty source (e.g., no MVP file in place).

---

## 8. Short Summary for Grant Proposals

- **NSF data:** Sourced **only** from **NSF Award Search bulk download** (JSON files). **No** use of the NSF AwardSearch API.  
- **Other data:** Harvard/MVP pipeline data is a **fallback** when NSF-derived file is absent; it is **not** NSF data.  
- **Where NSF data lives:** In the file **`faculty_pipeline/output/nsf_all_faculty.json`**. The **database** does not store NSF PIs or institutions; it stores only users, profiles, saved PIs, resumes, and tokens.  
- **Features:** When the NSF file is in use, **all** faculty-dependent features (browse, filters, matching, saved PIs, email drafting, onboarding institution list) use that NSF-derived data, with the caveat that contact information may be incomplete where the bulk export does not provide it.

This document may be attached to NSF grant applications to clarify data sources and use of NSF data.
