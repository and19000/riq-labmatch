{% extends "base.html" %}

{% block content %}
  <h1>Export Lab Report</h1>
  <p class="subtitle">Download a summary of your top lab matches</p>

  {% if labs %}
    <div class="export-options">
      <button onclick="window.print()" class="btn-primary">Print / Save as PDF</button>
      <button onclick="copyReport()" class="btn-secondary">Copy Report Text</button>
      <a href="{{ url_for('saved_pis') }}" class="btn-secondary">‚Üê Back to Saved Labs</a>
    </div>

    <div class="report-content" id="report-content">
      <div class="report-header">
        <h2>RIQ Lab Matcher - Research Opportunity Report</h2>
        <p><strong>Generated for:</strong> {{ user.username }} ({{ user.email }})</p>
        <p><strong>Date:</strong> {{ current_date }}</p>
      </div>

      <div class="report-summary">
        <h3>Summary</h3>
        <p>This report contains {{ labs|length }} research lab{{ 's' if labs|length != 1 else '' }} that match your profile and interests.</p>
      </div>

      {% for lab in labs %}
        <div class="report-lab-entry">
          <h3>{{ loop.index }}. {{ lab.name }}</h3>
          <div class="report-lab-details">
            <p><strong>Title:</strong> {{ lab.title }}</p>
            <p><strong>Institution:</strong> {{ lab.school }}</p>
            <p><strong>Department:</strong> {{ lab.department }}</p>
            {% if lab.get('h_index') %}
              <p><strong>H-index:</strong> {{ lab.h_index }}</p>
            {% endif %}
            <p><strong>Research Areas:</strong> {{ lab.research_areas }}</p>
            {% if lab.get('lab_techniques') %}
              <p><strong>Lab Techniques:</strong> {{ lab.lab_techniques }}</p>
            {% endif %}
            <p><strong>Location:</strong> {{ lab.get('specific_location', lab.location) }}</p>
            {% if lab.website %}
              <p><strong>Website:</strong> <a href="{{ lab.website }}">{{ lab.website }}</a></p>
            {% endif %}
            <p><strong>Email:</strong> {{ lab.email }}</p>
            {% if lab.get('match_reason') %}
              <div class="report-match-reason">
                <strong>Why this match:</strong> {{ lab.match_reason }}
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}

      <div class="report-footer">
        <p><em>Report generated by RIQ Lab Matcher. For more information, visit the platform.</em></p>
      </div>
    </div>
  {% else %}
    <div class="no-results">
      <p>No labs to export. Save some labs first!</p>
      <a href="{{ url_for('general') }}" class="btn-primary">Browse Labs</a>
    </div>
  {% endif %}

  <script>
    function copyReport() {
      const reportText = document.getElementById('report-content').innerText;
      navigator.clipboard.writeText(reportText).then(() => {
        alert('Report copied to clipboard!');
      });
    }
    
    function downloadPDF() {
      // Use browser's print to PDF functionality
      window.print();
    }
  </script>
{% endblock %}


